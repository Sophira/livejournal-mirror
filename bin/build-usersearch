#!/usr/bin/perl
use strict;
use lib "$ENV{LJHOME}/cgi-bin";
require 'ljlib.pl';

my $filename = shift
    or die "Usage: build-usersearch <packdata-file>\n";

use Carp;

$SIG{__DIE__} = sub { Carp::croak( @_ ) };

use LJ::UserSearch::MetaUpdater;

while (LJ::UserSearch::MetaUpdater::missing_rows()) {
    print "adding missing rows....\n";
    LJ::UserSearch::MetaUpdater::add_some_missing_rows();
}

# TODO: find things that are good_until NOT NULL, but expired, and update those rows

LJ::UserSearch::MetaUpdater::update_file($filename);

