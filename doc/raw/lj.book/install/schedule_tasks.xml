<chapter id="lj.install.schedule_tasks">
  <title>Scheduling Maintenence tasks</title>
  <para>
    From the LiveJournal user account (or whatever user is running LJ), you need to install some crontabs.  These are periodic commands that run and manage your LiveJournal installation.
  </para>
  <para>
    <screen>
      <prompt>$</prompt> <userinput>crontab -e</userinput>
    </screen>
    <note>
      <para>This will bring up either your $EDITOR, or vi.  If you want to set your editor explicitly, do:
        <screen><prompt>$</prompt> <command>EDITOR=pico crontab -e</command></screen>
      </para>
    </note>
    <caution>
      <para>
        Prolonged use of pico can cause insanity.  You are encouraged to learn emacs or vi.
      </para>
    </caution>
  </para>
  <para>
    Now, enter the following stuff between the dotted lines below.  Not all of it is necessary.  See the comments below.  The LJHOME= line is required.  See the section above about how the $LJHOME environment variable is required everywhere.  This is another place.
  </para>
  <para>
    <programlisting>
<![CDATA[
LJHOME=/home/lj
MAILTO=youremail@wherever.com

# Essential:
* * * * * /home/lj/bin/ljmaint.pl db_batchdelete >/dev/null
* */12 * * * /home/lj/bin/ljmaint.pl clean_caches >/dev/null

# Optional, if you want birthday mail, and the random user feature:
# (you can remove parts)
5 1 * * * /home/lj/bin/ljmaint.pl bdaymail build_randomuserset >/dev/null

# If you want statistics:
30 1 * * * /home/lj/bin/ljmaint.pl genstats genstatspics >/dev/null
5 2 * * 0 /home/lj/bin/ljmaint.pl genstats_weekly > /dev/null

# If you're running a high-load site with $LJ::BUFFER_QUERIES on,
# there's another one to install:
*/5 * * * * /home/lj/bin/qbufferd.pl >/dev/null
]]>
    </programlisting>
  </para>
  <para>
    If query buffering is off, you can still run that, but it's not needed.  Packagers should make their packages install it, since it doesn't hurt if it's running and not used.  It'll die off right away if it realizes it's not needed.  Otherwise it'll start up in the background and run every 10 seconds or so. Future startups by cron will only make sure it hasn't died (like if the database dies).
  </para>
  <note>
    <title>Scheduling Windows Tasks</title>
    <para>
      2000/NT/XP versions of Windows offer the <literal>AT</literal> command, which you can use to set regular maintainence tasks like the ones listed above. Older versions may offer programs such as Task Scheduler, but you might have to perform these tasks on your own.
    </para>
  </note>
</chapter>