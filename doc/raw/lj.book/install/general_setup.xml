<chapter id="lj.install.general_setup">
  <title>General Setup</title>
  <section id="ljhome_var">
  <title>$LJHOME Environment Variable</title>
  <para>
    Be aware that nearly all LiveJournal code depends on the <literal>$LJHOME</literal> environment variable being set to the top-level directory that LiveJournal is installed at.
  </para>
  <para>
    <xref linkend="lj.install.apache_setup" /> has the necessary directives to make sure the web code always has $LJHOME set, but if you're running LJ maintenance commands from a terminal, you'll need to make sure <literal>$LJHOME</literal> is set for yourself.
  </para>
  <para>
    For example, we'll assume that you've installed LiveJournal on an operating system using the Bourne Shell: The easiest way to set <literal>$LJHOME</literal> is to put the following in your <filename>~/.bash_profile</filename>:
  </para>
  <para>
    <screen><literal>LJHOME=/home/lj; export LJHOME</literal></screen>
  </para>
  <para>
    To test that it's set:
  </para>
  <para>
    <screen><prompt>$</prompt> <userinput>. ~/.bash_profile</userinput>
<prompt>$</prompt> <userinput>echo $LJHOME</userinput></screen>
  </para>
  <para>
    If the above was successful, it should print out <literal>/home/lj</literal> (or whatever the value of <literal>$LJHOME</literal> may be).
  </para>
  <note>
    <title>Other shells</title>
    <para>
      If you use another shell interface, you might be able to see what it reads on start-up by looking for the file: <filename>~/.profile</filename>. Please refer to the documentation provided with your shell, which can usually be found by typing:
      <screen><prompt>$</prompt> <userinput>help</userinput>
      </screen>
    </para>
  </note>
  <note>
    <title>Windows Environment Variables</title>
    <para>
      Defining a environment variable varies on the different Windows OS systems<footnote id="win32_env_vars"><para>For more information, please refer to <ulink url="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/vccore98/HTML/_core_using_environment_variables.asp" /></para></footnote>:
      <procedure><title>Windows 95/98/ME</title>
        <step><para>Add an environment variable titled LJHOME to the <filename>autoexec.bat</filename> file, and define the variable with your 
        install directory, such as <computeroutput>LJHOME=C:\lj</computeroutput></para></step>
        <step><para>Restart Windows for the change to take effect.</para></step>
      </procedure>
      <procedure><title>Windows NT/2000/XP</title>
        <step><para>On the Start menu, point to Settings, then click Control Panel.</para></step>
        <step><para>In the Control Panel, double click System.</para></step>
        <step><para>In the System Properties dialog box, click the Environment tab, and specify an 
        environment variable named LJHOME, with the value of your install directory (<quote><filename>C:\lj</filename></quote> or something similar). </para></step>
        <step><para>Exit the development environment and restart it for the changed environment variable to take effect.</para></step> 
      </procedure>
    </para>
  </note>
  </section>
  <section id="lj.install.install_files">
  <title>Installing the files</title>
    <para>
      The typical directory to install LiveJournal is
      <filename>/home/lj</filename>, but it is not a requirement at
      all.  To ease documentation, we'll assume that you'll want to
      install in that directory.  We'll also assume you'll be using
      user <literal>lj</literal>, but that also doesn't matter at all.
      Feel free to install wherever and as whoever ... there shouldn't
      be any problems.  (and if there are, we'll fix it right away!)
    </para>

    <formalpara>
      <title>Creating your <link linkend='ljhome_var'><literal>$LJHOME</literal></link>.</title>
      <para>
        Before you install LiveJournal, you should create the directory
        where your LiveJournal installation will reside:
      </para>
      <para>
        <screen><prompt>#</prompt> <userinput>mkdir <replaceable>/home/lj</replaceable></userinput>
<prompt>#</prompt> <userinput>chown <replaceable>lj.lj /home/lj</replaceable></userinput></screen></para>
    </formalpara>

<!-- Uhh, lame:
    <formalpara>
      <title>Using the distributed tarball archives</title>
      <para>
        LiveJournal maintains the server code in <filename>.tar</filename> format, which can be downloaded from: <ulink url="http://www.livejournal.com/files/code/LiveJournal/" />.
      </para>
      <note>
        <para>
          The tarball creates a directory ("LiveJournal-YYYYMMDD"), so you'll either want to untar at <filename>/home/</filename> and then rename that directory to be lj, or do something like:
        </para>
        <para>
          <screen><prompt>$</prompt> <userinput>cd <replaceable>/home/lj</replaceable></userinput>
<prompt>$</prompt> <userinput>tar zxvf LiveJournal-<replaceable>YYYYMMDD</replaceable>.tar.gz</userinput>
<prompt>$</prompt> <userinput>mv LiveJournal-<replaceable>YYYYMMDD</replaceable>/* .</userinput>
<prompt>$</prompt> <userinput>rm -r LiveJournal-<replaceable>YYYYMMDD</replaceable></userinput></screen>
        </para>
      </note>
    </formalpara>
-->
    <formalpara>
      <title>Installing from CVS</title>
      <para>
        The recommended way to get the code is from anonymous CVS,
        which always represent the latest stable code.  We used to do
        tarball releases (and plan to start doing them again), but for
        now, just use CVS... it's painless.
      </para>
        <screen><prompt>$</prompt> <userinput>mkdir $LJHOME/cvs</userinput>
<prompt>$</prompt> <userinput>cd $LJHOME/cvs</userinput>
<prompt>$</prompt> <userinput>cvs -z3 -d:pserver:anonymous@cvs.livejournal.org:/home/cvslj co livejournal</userinput>
<prompt>$</prompt> <userinput>cvs -z3 -d:pserver:anonymous@danga.com:/home/cvspub co wcmtools bml</userinput>
<prompt>$</prompt> <userinput>wcmtools/bin/multicvs.pl --conf=livejournal/cvs/multicvs.conf --init</userinput></screen>
      <para>
        That last command will copy everything from the CVS directory
        over to <literal>$LJHOME</literal>, the live area.
      </para>
      <para>
        Having two copies of the code laying around may not make sense
        now, but it will later when we write the docs to explain how
        to run a heavily-customized version of the site and still stay
        up-to-date with the mainstream CVS.  (FIXME: write/link that section)
      </para>
    </formalpara>
  </section>
</chapter>