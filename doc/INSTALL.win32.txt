How to install LJ under a Win32 environment and not lose your 
sanity in the process.

NOTE: although the process described below should work on all of
Windows 95/98/ME/NT/2000/XP, it was only actually tried on Windows NT 4 
Workstation. If you can add information about whatever extra steps should 
be done on other platforms, or questions please contact us at the code 
mailing list. See http://lists.livejournal.com for information about 
subscription.

NOTE: do NOT rely on these instructions to create a production-quality
LiveJournal installation. These instructions are for developers, testers,
tinkerers, etc.

=====================================================================

1. First of all, you should install Apache, MySQL, and Perl.
Get Win32 versions of these from http://httpd.apache.org,
http://www.mysql.com, and http://www.activestate.com .

Perl: try not to install it under a path with spaces in it (such as 
"Program Files"), otherwise you'll have to escape the path to the Perl
interpreter with double-quotes all the time and some things might break.
Use the latest stable ActivePerl distribution (at the moment of writing
this stands at Perl 5.6.1 build 630).

MySQL: install it at the default location (c:\mysql), unless you're smart
enough to fix its configuration later, which is nontrivial. If MySQL is 
installed at the default location, starting c:\mysql\bin\mysqladmin.exe 
should install the service for the MySQL server and start it. The service
will continue to run after you exit the admin program and after reboots,
until you disable it in the admin program again.
The version of MySQL that we used was 3.23.44.

Apache: just install it. The version we used was 1.3.22.

2. Let's now install all the Perl modules we need for LJ. In ActivePerl,
the easiest way to do this by running "ppm" and then inside the manager 
by "install packagename". Refer to the main INSTALL.txt file for the list 
of Perl modules required by LJ. Lots of them are already in the default 
ActivePerl installation, but some aren't. 

If ppm can't find a package in its database, you need to manually download
it from CPAN, configure and install it. 

Three important modules without which nothing will run are:
- DBD::mysql
- DBI
- MIME::Lite

(the first two aren't mentioned in INSTALL.txt, but they're required).

Finally, we need to install the FCGI module, which provides support routines
for FastCGI scripts written in Perl. Refer to http://www.fastcgi.com for
more information about FastCGI. Unfortunately, at the time of writing ppm
cannot install the FCGI module, perhaps due to some glitch or lack of
maintenance, and so unless this is fixed you'll need to install it yourself.
To do this, download the latest version of the module (currently 0.64) from
http://www.fastcgi.com or CPAN and follow the instructions. You'll need
some sort of Visual C++ environment installed, sorry. If you don't have 
that, you might consider referring to the FastCGI mailing list for help.

3. Install the LiveJournal source tree. You can use either a generic
LiveJournal or ljcom-specific snapshot, or checkout directly from the
LJ CVS tree. Note that binary files, such as all images, are currently
stored incorrectly in the CVS tree (they're not flagged as binary), so 
if you check them out using a Win32 CVS client, they'll be broken by CRLF
translation. Use a snapshot or check them out on a Unix machine, then
transfer to your Win32 machine.

Let's assume from now on that the LJ tree is located at c:\lj.

4. Go to the Environment section in your Control Panel settings 
(e.g. under Control Panel->System->Environment under Windows NT). Define
a new environment variable called LJHOME, with the value "c:/lj" (note the
forward slash) or wherever your LJ tree is located. Save the environment
settings.

5. Go through your httpd.conf file in Apache installation and uncomment
appropriate LoadModule and AddModule directives to install modules 
required by LiveJournal. Refer to INSTALL.txt for the list of modules.
Download mod_fastcgi.dll from the FastCGI website (this is the Apache
FastCGI module, to not be confused with Perl FCGI module!), put it 
under modules/ subdirectory in the Apache tree, and add 
 
LoadModule fastcgi_module modules/mod_fastcgi.dll

and

AddModule mod_fastcgi.c

at the end of the appropriate sections.

5. Add the contents of INSTALL.apache.txt to the end of your httpd.conf. 
Change the domain name in the example to the domain name of your machine.

  NOTE: if your machine has no convenient DNS name, you may install a 
  dummy one in your "hosts" file (located at SYSTEM32/drivers/etc/hosts) 
  and make it refer to 127.0.0.1 . Be sure to define both "sillyname.com" 
  and "www.sillyname.com".

Now go through the example and change all occurrances of "/home/lj" into
"c:/lj" (or wherever your LJ tree is located). 

6. Connect to the MySQL server (using the mysql.exe client). Use 
instructions in INSTALL.txt to create the livejournal database and grant
appropriate rights. Run update-db.pl as described there to create and
populate the tables.

7. Copy the file doc/ljconfig.pl.txt in your LJ tree to cgi-bin/ljconfig.pl.
Go through the file and customize it; especially be sure to verify that
the domain name and the database information are correct.

8. Now we have to deal with the fact that FastCGI doesn't know how to
run Perl scripts, because they start with "#!/usr/bin/perl" which is
useless on your Win32 system. Look at all the FastCgiServer directives in
your httpd.conf file, open all the scripts mentioned there in a text editor
and change the first line from "#!/usr/bin/perl" to 
"#!c:\path\to\your\perl.exe". You needn't bother with all library .pl
file, just the files that are run from httpd.conf via FastCGI.

There might be a different way to deal with this which doesn't involve
changing distribution files. You can try creating c:\usr\bin and copying
there everything from the bin subdirectory of your perl installation.
This still doesn't seem to work as FastCGI starts up perl with very
limited PATH and it can't file the rest of its files. But maybe this 
method can be further tinkered with and brought to fruition.

9. Finally, open "htdocs/users". Find the lines "alarm 7;" and "alarm 0;" 
and comment them out. The alarm function is not yet supported in Win32 Perl.
This will not break the script.
=====================================

Run apache, either as a service or from console; verify that you have 
mysqld service running. You may now try to connect to your brand new
Win32 LJ installation.

WHAT WORKS: creation of users, updating and editing of journals, comments,
client-server protocol, and all other usual features of the site should 
work.

WHAT DOESN'T WORK:
- any mail-sending that LJ code does: comment notification, validation
requests, etc. Maybe we can try to find a simple Win32 command-line 
mail-sending utility to put into ljconfig.pl instead of sendmail.

- administration scripts such as ljrpc/ljrpcd, maintenance scripts, cron
jobs. 

Comments are welcome.
-- avva@livejournal.com