#!/usr/bin/perl

use strict;
use lib "$ENV{LJHOME}/cgi-bin";
use lib "$ENV{LJHOME}/src/djabberd/lib";
require 'ljconfig.pl';

use DJabberd;
use DJabberd::Auth::AllowedUsers;
use DJabberd::Auth::StaticPassword;
use DJabberd::Delivery::FakeSMS;
use DJabberd::Delivery::Local;
use DJabberd::RosterStorage::FakeSMS;
use Getopt::Long;

use vars qw($DEBUG);
$DEBUG = 0;

my ($daemonize);

Getopt::Long::GetOptions(
    'd|daemon'       => \$daemonize,
    'debug=i'        => \$DEBUG,
   );

use FindBin qw($Bin);

my $server = DJabberd->new(
                           server_name => $LJ::DOMAIN,
                           daemonize => $daemonize,
                           s2s       => 0,
                           plugins   => [
                                         DJabberd::Auth::AllowedUsers->new(policy => "deny",
                                                                           allowed => [qr/^\+?\d+/, 'livejournal']),
                                         DJabberd::Auth::StaticPassword->new(password => "smstest"),
                                         DJabberd::Delivery::FakeSMS->new(),
                                         DJabberd::Delivery::Local->new(),
                                         DJabberd::RosterStorage::FakeSMS->new(),
                                         ],
                           );
$server->run;
