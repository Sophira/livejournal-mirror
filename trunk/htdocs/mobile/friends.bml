<html>
<head>
<title>Friends Page</title>
</head>
<body>
<p><?_code
{
    my $u = LJ::User->remote
	or return "You must <a href='login.bml'>log in</a> to read your friends page.";

    my $ret;
    $ret .= "<a href='./'>&lt;&lt; Back</a> to LiveJournal Mobile.</a><h1>Friends Page</h1>";

    my @entries = LJ::get_friend_items({
	'remoteid'          => $u->{'userid'},
	'itemshow'          => 50,
	'skip'              => 0,
	'showtypes'         => 'PYC',
	'u'                 => $u,
	'userid'            => $u->{'userid'},
    });

    # how many characters to truncate entry at
    my $max_entry_length = 400;

    foreach my $ei (@entries) {
	next unless $ei;
	my $entry;
	if ($ei->{'ditemid'}) {
	    $entry = LJ::Entry->new($ei->{'journalid'},
				    ditemid => $ei->{'ditemid'});
	} elsif ($ei->{'jitemid'} && $ei->{'anum'}) {
	    $entry = LJ::Entry->new($ei->{'journalid'},
				    jitemid => $ei->{'jitemid'},
				    anum    => $ei->{'anum'});
	}
	next unless $entry;

	my $pu    = $entry->poster;
	my $ju    = $entry->journal;
	my $url   = $entry->url;
	$url .= "?fallback=bml&usescheme=lynx";

	my $who = $pu->ljuser_display;
	if ($pu->{userid} != $ju->{userid}) {
	    $who .= " in " . $ju->ljuser_display;
	}

	$ret .= "$who: " . "<a href='$url'>" . ($entry->subject_html || "(no subject)") . "</a><br />";
    }

    return $ret;
}
_code?>

</body>
</html>
