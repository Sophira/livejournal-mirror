<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type"><title>1. Writing Hooks</title><link rel="stylesheet" href="style.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.55.0"><link rel="home" href="index.html" title="LiveJournal Server"><link rel="up" href="lj.customize.hooks.html" title="Chapter 17. Setting Site-Specific Hooks"><link rel="previous" href="lj.customize.hooks.html" title="Chapter 17. Setting Site-Specific Hooks"><link rel="next" href="lj.customize.hooks.ref.html" title="2. Hooks Reference"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1. Writing Hooks</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="lj.customize.hooks.html">Prev</a> </td><th width="60%" align="center">Chapter 17. Setting Site-Specific Hooks</th><td width="20%" align="right"> <a accesskey="n" href="lj.customize.hooks.ref.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><h2 class="title" style="clear: both"><a class="linkhere" href="#lj.customize.hooks.setup">»</a><a name="lj.customize.hooks.setup"></a>1. Writing Hooks</h2></div></div><p>
      Hooks are written either in your <tt>cgi-bin/ljconfig.pl</tt> file, or in a seperate
      site-specific library file. Hooks are defined by the function <tt>LJ::register_hook()</tt>,
      which takes two arguments: the name of the hook, and the hook's perl coderef.
    </p><p>
      Most hook coderefs are passed a single hash of various objects as their argument, though there are a few
      exceptions. Consult <a href="lj.customize.hooks.ref.html" title="2. Hooks Reference">Section 2: Hooks Reference</a> for more information.
    </p><div class="example"><p class="title"><b>Example 17.1. Sample hook: userinfo_html_by_user</b></p><p>
        To give you an idea of how a hook is set up, a smaller hook is sampled below:
      </p><pre class="programlisting">LJ::register_hook(&quot;userinfo_html_by_user&quot;, sub {
    my $o = shift;
    my $r = $o-&gt;{'ret'};
    my $u = $o-&gt;{'u'};
    return unless (LJ::get_cap($u, &quot;normal&quot;));
    $$r .= &quot;&lt;img src='$LJ::IMGPREFIX/talk/sm08_star.gif' width='20' height='18' alt='&amp;#8902;' style='vertical-align: middle; border: 0;' /&gt;&quot;;
        });</pre><p>
        <tt>$o</tt> is the argument hash that is passed to the hook's subroutine,
        and consists of the scalar reference member <tt>$o-&gt;{'r'}</tt> and the user object
        member <tt>$o-&gt;{'u'}</tt>. The subroutine then checks to see if the user
        is part of the capability class &#8216;normal&#8217;, and if so it will pass the
        HTML image directive as the scalar reference. Now when someone loads
        a user information page for a &#8216;normal&#8217; user, a small star will appear
        next to their username and userid.
      </p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="lj.customize.hooks.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="lj.customize.hooks.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="lj.customize.hooks.ref.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 17. Setting Site-Specific Hooks </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 2. Hooks Reference</td></tr></table></div></body></html>
