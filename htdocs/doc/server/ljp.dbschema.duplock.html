<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type"><title>
      duplock
    </title><link rel="stylesheet" href="style.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.55.0"><link rel="home" href="index.html" title="LiveJournal Server"><link rel="up" href="ljp.dbschema.ref.html" title="Database Schema Browser"><link rel="previous" href="ljp.dbschema.dudata.html" title="
      dudata
    "><link rel="next" href="ljp.dbschema.email_aliases.html" title="
      email_aliases
    "></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">
      duplock
    </th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ljp.dbschema.dudata.html">Prev</a> </td><th width="60%" align="center">Database Schema Browser</th><td width="20%" align="right"> <a accesskey="n" href="ljp.dbschema.email_aliases.html">Next</a></td></tr></table><hr></div><div class="refentry"><a class="linkhere" href="#ljp.dbschema.duplock">»</a><a name="ljp.dbschema.duplock"></a><div class="titlepage"></div><div class="refnamediv"><h2>
      duplock
    </h2><p>
      duplock
     &#8212; Provides a place to record that an action has been done, so it doesn't get done a second time later by a user accidentally double-clicking a single-click button in their browser.

The idea is that the application should grab a write lock for both the table it's inserting into, and the duplock table.  Then, check the duplock table for a duplicate.  If it's already in there, unlock the tables and remember the dupid to tell the user (app should pretend it was the first time... don't show an error message!), or if it's not in there, put it in the table, and then put the resulting uniqueid from the table handler into the duplock table (as dupid).

The duplock table is purged every hour or so of all locks older than an hour.</p></div><div class="refsect1"><h2>
      duplock
    </h2><div class="informaltable"><table border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th>Column name</th><th>Type</th><th>Null</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>realm</td><td>enum('support','log','comment','payments')</td><td align="center"> </td><td align="center"><tt>support</tt></td><td>The area of the site the lock is being provided for.</td></tr><tr><td>reid</td><td>int unsigned</td><td align="center"> </td><td align="center"><tt>0</tt></td><td>Realm ID.  If you don't need it (most don't), use 0.  Example: for comment realm, reid is the itemid being replied to.</td></tr><tr><td>userid</td><td>int unsigned</td><td align="center"> </td><td align="center"><tt>0</tt></td><td>The userid doing the action, or 0 if user is unknown (as in support realm)</td></tr><tr><td>digest</td><td>char(32)</td><td align="center"> </td><td align="center"><tt></tt></td><td>The md5 digest of the event.  Concatenate everything important and run it through perl's md5_hex (or MySQL's md5)</td></tr><tr><td>dupid</td><td>int unsigned</td><td align="center"> </td><td align="center"><tt>0</tt></td><td>The unique ID this action generated the first time.</td></tr><tr><td>instime</td><td>datetime</td><td align="center"> </td><td align="center"><tt>0000-00-00 00:00:00</tt></td><td>The time the action first completed.</td></tr></tbody></table></div><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Key name</th><th>Type</th><th>Column(s)</th></tr></thead><tbody><tr><td>instime</td><td>INDEX</td><td></td></tr><tr><td>realm</td><td>INDEX</td><td></td></tr></tbody></table></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ljp.dbschema.dudata.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ljp.dbschema.ref.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ljp.dbschema.email_aliases.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">
      dudata
     </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 
      email_aliases
    </td></tr></table></div></body></html>
