<TMPL_IF warnscreened>
    <div class='ljwarnscreened'><TMPL_VAR expr="ml('/talkpost.bml.warnscreened')"></div>
</TMPL_IF>

<form method='post' action='<TMPL_VAR lj_siteroot>/talkpost_do.bml' id='postform'>
<TMPL_VAR form_intro>

<TMPL_IF errors>
    <ul>
        <TMPL_LOOP errors>
            <li><TMPL_VAR error></li>
        </TMPL_LOOP>
    </ul>
    <hr/>
</TMPL_IF>

<TMPL_VAR tosagree>

<TMPL_VAR create_link>

<table>
<tr>
    <td align='right' valign='top'><TMPL_VAR expr="ml('/talkpost.bml.opt.from')"></td>
    <td> <TMPL_IF 0> Internal for "From" options </TMPL_IF>
        <table>
            <TMPL_IF editid>
                <tr valign='middle' id='ljuser_row'>
                    <TMPL_IF remote_banned>
                        <td align='center'><img src='<TMPL_VAR lj_imgprefix>/userinfo.gif' /></td>
                        <td align='center'>( )</td>
                        <td align='left'><span class='ljdeem'><TMPL_VAR ml_loggedin></font><TMPL_VAR ml_banned></td>
                    <TMPL_ELSE>
                        <td align='center'><img src='<TMPL_VAR lj_imgprefix>/userinfo.gif'  onclick='handleRadios(1);' /></td>
                        <td align='left'><label for='talkpostfromremote'><TMPL_VAR ml_loggedin></label>
                        <input type='hidden' name='usertype' value='cookieuser' />
                        <input type='hidden' name='cookieuser' value='<TMPL_VAR remote_username>' id='cookieuser' />
                        </td>
                    </TMPL_IF>
                </tr>
            <TMPL_ELSE>
                <TMPL_IF everyone_can_comment>
                    <TMPL_UNLESS is_public>
                        <tr valign='middle'>
                        <td align='center' width='20'><img src='<TMPL_VAR lj_imgprefix>/anonymous.gif' /></td>
                        <td align='center'>(  )</td>
                        <td align='left' colspan='2'>
                            <font color='#c0c0c0'><b><TMPL_VAR expr="ml('/talkpost.bml.opt.anonymous')"></b></font>
                            <TMPL_VAR expr="ml('/talkpost.bml.opt.noanonpost.nonpublic')">
                        </td>
                        </tr>
                    <TMPL_ELSE>
                        <tr valign='center'>
                        <td align='center'><img src='<TMPL_VAR lj_imgprefix>/anonymous.gif' onclick='handleRadios(0);'/></td>
                        <td align='center'><input type='radio' name='usertype' value='anonymous' id='talkpostfromanon' <TMPL_VAR whocheck_anonymous> /></td>
                        <td align='left'>
                            <b><label for='talkpostfromanon'><TMPL_VAR expr="ml('/talkpost.bml.opt.anonymous')"></label></b>
                            <TMPL_VAR ml_willscreen>
                        </td>
                        </tr>
                    </TMPL_IF>

                    <TMPL_IF openid_enabled>
                        <TMPL_IF is_identity>
                            <tr valign='middle' id='oidli' name='oidli'>
                            <td align='center'><img src='<TMPL_VAR lj_imgprefix>/openid-profile.gif' onclick='handleRadios(4);' /></td>
                            <td align='center'><input type='radio' name='usertype' value='openid_cookie' id='talkpostfromoidli' <TMPL_VAR whocheck_openid_cookie> /></td>
                            <td align='left'>
                                <b><label for='talkpostfromoid' onclick='handleRadios(4);return false;'>OpenID identity:</label></b>
                                <strong><TMPL_VAR remote_display_name></strong>
                                <TMPL_VAR ml_willscreen>
                            </td>
                            </tr>
                        <TMPL_ELSE>
                            <tr valign='middle' id='oidlo' name='oidlo'>
                            <td align='center'><img src='<TMPL_VAR lj_imgprefix>/openid-profile.gif' onclick='handleRadios(3);' /></td>
                            <td align='center'><input type='radio' name='usertype' value='openid' id='talkpostfromoidlo' <TMPL_VAR whocheck_openid> /></td>
                            <td align='left'>
                                <b><label for='talkpostfromoidlo' onclick='handleRadios(3);return false;'>OpenID</label></b>
                                <TMPL_VAR helpicon_openid>
                                <TMPL_VAR ml_willscreen>
                            </td>
                            </tr>
                        </TMPL_IF>

                        <tr valign='middle' align='left' id='oid_more'>
                        <td colspan='2'></td>
                        <td>
                            Identity URL:&nbsp;<input class='textbox' name='oidurl' maxlength='60' size='53' id='oidurl' value='<TMPL_VAR openid_url_default>' />
                            <br />
                            <label for='oidlogincheck'><TMPL_VAR expr="ml('/talkpost.bml.loginq')">&nbsp;</label>
                            <input type='checkbox' name='oiddo_login' id='oidlogincheck' <TMPL_VAR oiddo_login_checked> />
                        </td>
                        </tr>
                    </TMPL_IF>
                <TMPL_ELSIF registered_can_comment>
                    <tr valign='middle'>
                    <td align='center' width='20'><img src='<TMPL_VAR lj_imgprefix>/anonymous.gif' /></td>
                    <td align='center'>(  )</td>
                    <td align='left' colspan='2'>
                        <font color='#c0c0c0'><b><TMPL_VAR expr="ml('/talkpost.bml.opt.anonymous')"></b></font>
                        <TMPL_VAR expr="ml('/talkpost.bml.opt.noanonpost')">
                    </td>
                    </tr>

                    <TMPL_IF openid_enabled>
                        <TMPL_IF is_trusted_identity>
                            <tr valign='middle' id='oidli' name='oidli'>
                            <TMPL_IF remote_banned>
                                <td align='center'><img src='<TMPL_VAR lj_imgprefix>/openid-profile.gif' /></td>
                                <td align='center'>( )</td>
                                <td align='left'><span class='ljdeem'><TMPL_VAR ml_loggedin></font><TMPL_VAR ml_banned></td>
                            <TMPL_ELSE>
                                <td align='center'><img src='<TMPL_VAR lj_imgprefix>/openid-profile.gif' onclick='handleRadios(4);' /></td>
                                <td align='center'><input type='radio' name='usertype' value='openid_cookie' id='talkpostfromoidli' <TMPL_VAR whocheck_openid_cookie> /></td>
                                <td align='left'>
                                    <b><label for='talkpostfromoid' onclick='handleRadios(4);return false;'>OpenID identity:</label></b>
                                    <strong><TMPL_VAR remote_display_name></strong>
                                    <TMPL_VAR ml_willscreen>
                                </td>
                            </TMPL_IF>
                            </tr>
                        <TMPL_ELSE>
                            <tr valign='middle'>
                            <td align='center'><img src='<TMPL_VAR lj_imgprefix>/openid-profile.gif' onclick='handleRadios(3);' /></td>
                            <td align='center'>(  )</td>
                            <td align='left' colspan='2'>
                                <font color='#c0c0c0'><b>OpenID</b></font>
                                <TMPL_IF is_identity><TMPL_VAR ml_noopenidpost></TMPL_IF>
                                <TMPL_VAR helpicon_openid>
                            </td>
                            </tr>
                        </TMPL_IF>
                    </TMPL_IF>
                <TMPL_ELSIF friends_can_comment>
                    <tr valign='middle'>
                    <td align='center' width='20'><img src='<TMPL_VAR lj_imgprefix>/anonymous.gif' /></td>
                    <td align='center'>(  )</td>
                    <td align='left' colspan='2'>
                        <font color='#c0c0c0'><b><TMPL_VAR expr="ml('/talkpost.bml.opt.anonymous')"></b></font>
                        <TMPL_VAR ml_friendsonly>
                    </td>
                    </tr>

                    <TMPL_IF openid_enabled>
                        <TMPL_IF is_identity>
                            <tr valign='middle' id='oidli' name='oidli'>
                            <td align='center'><img src='<TMPL_VAR lj_imgprefix>/openid-profile.gif' onclick='handleRadios(4);' /></td>

                            <TMPL_IF remote_can_comment>
                                <td align='center'><input type='radio' name='usertype' value='openid_cookie' id='talkpostfromoidli' <TMPL_VAR whocheck_openid_cookie> /></td>
                                <td align='left'>
                                    <b><label for='talkpostfromoid' onclick='handleRadios(4);return false;'>OpenID identity:</label></b>
                                    <strong><TMPL_VAR remote_display_name></strong>
                                    <TMPL_VAR ml_willscreen>
                                </td>
                            <TMPL_ELSE>
                                <td align='center'>( )</td>
                                <td align='left'>
                                    <b><font color='#c0c0c0'>OpenID identity:</font></b>&nbsp;
                                    <strong><TMPL_VAR remote_display_name></strong>
                                    <TMPL_VAR ml_notafriend>
                                    <TMPL_VAR ml_willscreen>
                                </td>
                            </TMPL_IF>

                            </tr>
                        <TMPL_ELSE>
                            <tr valign='middle' id='oidlo' name='oidlo'>
                            <td align='center'><img src='<TMPL_VAR lj_imgprefix>/openid-profile.gif' onclick='handleRadios(3);' /></td>
                            <td align='center'><input type='radio' name='usertype' value='openid' id='talkpostfromoidlo' <TMPL_VAR whocheck_openid> /></td>
                            <td align='left'>
                                <b><label for='talkpostfromoidlo' onclick='handleRadios(3);return false;'>OpenID</label></b>
                                <TMPL_VAR helpicon_openid>
                                <TMPL_VAR ml_willscreen>
                            </td>
                            </tr>
                        </TMPL_IF>

                        <tr valign='middle' align='left' id='oid_more'>
                        <td colspan='2'></td>
                        <td>
                            Identity URL:&nbsp;<input class='textbox' name='oidurl' maxlength='60' size='53' id='oidurl' value='<TMPL_VAR openid_url_default>' />
                            <br />
                            <label for='oidlogincheck'><TMPL_VAR expr="ml('/talkpost.bml.loginq')">&nbsp;</label>
                            <input type='checkbox' name='oiddo_login' id='oidlogincheck' <TMPL_VAR oiddo_login_checked> />
                        </td>
                        </tr>
                    </TMPL_IF>
                </TMPL_IF>

                <TMPL_IF is_person>
                    <tr valign='middle' id='<TMPL_VAR css_ljuser_row_id>'>

                    <TMPL_IF remote_banned>
                        <td align='center'><img src='<TMPL_VAR lj_imgprefix>/userinfo.gif' /></td>
                        <td align='center'>( )</td>
                        <td align='left'>
                            <span class='ljdeem'><TMPL_VAR ml_loggedin></font>
                            <TMPL_VAR ml_banned>

                            <TMPL_IF 0> Don't worry about a real href since js hides the row anyway </TMPL_IF>
                            <script language='JavaScript'>
                                if (document.getElementById) {
                                    document.write("&nbsp;<a href='#' onClick='otherLJUser();return false;'>[other]</a>");
                                }
                            </script>
                        </td>
                    <TMPL_ELSE>
                        <td align='center'><img src='<TMPL_VAR lj_imgprefix>/userinfo.gif'  onclick='handleRadios(1);' /></td>
                        <TMPL_IF remote_can_comment>
                            <td align='center'><input type='radio' name='usertype' value='cookieuser' id='talkpostfromremote' <TMPL_VAR whocheck_remote> /></td>
                            <td align='left'>
                                <label for='talkpostfromremote'><TMPL_VAR ml_loggedin></label>

                                <TMPL_IF 0> Don't worry about a real href since js hides the row anyway </TMPL_IF>
                                <script language='JavaScript'>
                                    if (document.getElementById) {
                                        document.write("&nbsp;<a href='#' onClick='otherLJUser();return false;'>[other]</a>");
                                    }
                                </script>
                                <input type='hidden' name='cookieuser' value='<TMPL_VAR remote_username>' id='cookieuser' />
                                <TMPL_VAR ml_willscreen>
                            </td>
                        <TMPL_ELSE>
                            <td align='center'>( )</td>
                            <td align='left'>
                                <font color='#c0c0c0'><TMPL_VAR ml_loggedin></font>
                                &nbsp;- <TMPL_VAR ml_notafriend>
                                <input type='hidden' name='cookieuser' value='<TMPL_VAR remote_username>' id='cookieuser' />
                                <TMPL_VAR ml_willscreen>
                            </td>
                        </TMPL_IF>
                    </TMPL_IF>
                    </tr>
                </TMPL_IF>

                <tr valign='middle' id='otherljuser_row' name='otherljuser_row'>
                <td align='center'><img src='<TMPL_VAR lj_imgprefix>/pencil.gif' onclick='handleRadios(2);' /></td>
                <td align='center'><input type='radio' name='usertype' value='user' id='talkpostfromlj' <TMPL_VAR whocheck_ljuser> /></td>
                <td align='left'>
                    <b><label for='talkpostfromlj' onclick='handleRadios(2); return false;'><TMPL_VAR expr="ml('/talkpost.bml.opt.ljuser2')"></label></b>
                    <TMPL_VAR ml_willscreen>
                    <TMPL_VAR ml_willscreenfriend>
                </td>
                </tr>

                <TMPL_IF is_person>
                    <script language='JavaScript'>
                    <!--
                        if (document.getElementById) {
                            var radio_user = document.getElementById("talkpostfromlj");
                            if (!radio_user.checked) {
                                var otherljuser_row = document.getElementById("otherljuser_row");
                                otherljuser_row.className = 'display_none';
                            }
                        }
                    //-->
                    </script>
                </TMPL_IF>

                <tr valign='middle' align='left' id='lj_more'>
                <td colspan='2'></td>
                <td>
                    <table>
                        <tr>
                            <td><TMPL_VAR expr="ml('Username')">:</td>
                            <td>
                                <input class='textbox' name='userpost' size='13' maxlength='15' id='username' value='<TMPL_VAR username_default>' onclick='this.value=""'
                                    style='background: url(<TMPL_VAR lj_imgprefix>/userinfo.gif) no-repeat; background-color: #fff; background-position: 0px 1px; padding-left: 18px; color: #00C; font-weight: bold;'
                                />
                            </td>
                        </tr>
                        <tr>
                            <td><TMPL_VAR expr="ml('Password')">:</td>
                            <td><input class='textbox' name='password' type='password' maxlength='30' size='18' id='password' /></td>
                        </tr>
                        <tr>
                            <td colspan='2'>
                                <label for='logincheck'><TMPL_VAR expr="ml('/talkpost.bml.loginq')">&nbsp;</label>
                                <input type='checkbox' name='do_login' id='logincheck' />
                            </td>
                        </tr>
                    </table>
                </td>
                </tr>

                <TMPL_UNLESS create_link>
                    <TMPL_UNLESS is_person>
                        <tr valign='middle' align='left'>
                        <td colspan='2'></td>
                        <td><span style='font-size: 8pt; font-style: italic;'><TMPL_VAR ml_noaccount></span></td>
                        </tr>
                    </TMPL_UNLESS>
                </TMPL_UNLESS>
            </TMPL_IF>
        </table>
    </td>
</tr>

<tr valign='top'>
    <td align='right'><TMPL_VAR expr="ml('/talkpost.bml.opt.subject')"></td>
    <td>
        <input class='textbox' type='text' size='50' maxlength='100' name='subject' id='subject' value="<TMPL_VAR basesubject>" onKeyPress='subjectNoHTML(event);'/>

        <TMPL_IF 0> subject icon </TMPL_IF>
            <input type='hidden' id='subjectIconField' name='subjecticon' value='$subjicon'>
            <script type='text/javascript' language='Javascript'>
            <!--
                if (document.getElementById) {
                    <TMPL_IF subjicon_none>
                        document.write("<img src='<TMPL_VAR lj_imgprefix>/talk/none.gif' border='0' width='15' height='15' valign='middle' id='subjectIconImage' style='cursor:pointer;cursor:hand' align='absmiddle' onclick='subjectIconListToggle();' title='Click to change the subject icon' />");
                    <TMPL_ELSE>
                        document.write("<img src='<TMPL_VAR lj_imgprefix>/talk/<TMPL_VAR subjicon_current_img>' border='0' width='<TMPL_VAR subjicon_current_w>' height='<TMPL_VAR subjicon_current_h>' valign='middle' id='subjectIconImage' onclick='subjectIconListToggle();' style='cursor:pointer;cursor:hand' />");
                    </TMPL_IF>

                    <TMPL_IF 0> spit out a pretty table of all the possible subjecticons </TMPL_IF>
                    document.write("<blockquote style='display:none;' id='subjectIconList'>");
                    document.write("<table border='0' cellspacing='5' cellpadding='0' style='border: 1px solid #AAAAAA'>");

                    <TMPL_LOOP subjicon_types>
                        document.write("<tr>");

                        <TMPL_IF __first__> <TMPL_IF 0> make an option if they don't want an image </TMPL_IF>
                            document.write("<td valign='middle' align='center'>");
                            document.write("<img src='<TMPL_VAR lj_imgprefix>/talk/none.gif' border='0' width='15' height='15' valign='middle' id='none' onclick='subjectIconChange(this);' style='cursor:pointer;cursor:hand' title='No subject icon' />")
                            document.write("</td>");
                        </TMPL_IF>

                        <TMPL_LOOP subjicons>
                            document.write("<td valign='middle' align='center'>");
                            document.write("<img src='<TMPL_VAR lj_imgprefix>/talk/<TMPL_VAR subjicon_img>' border='0' width='<TMPL_VAR subjicon_w>' height='<TMPL_VAR subjicon_h>' valign='middle' id='<TMPL_VAR subjicon_id>' onclick='subjectIconChange(this);' style='cursor:pointer;cursor:hand' />");
                            document.write("</td>");
                        </TMPL_LOOP>

                        document.write("</tr>");
                    </TMPL_LOOP>

                    <TMPL_IF 0> end that table, bar! </TMPL_IF>
                    document.write("</table>");
                    document.write("</blockquote>");
                }
            //-->
            </script>
        <TMPL_IF 0> end subject icon </TMPL_IF>

        <div id='ljnohtmlsubj' class='ljdeem'><span style='font-size: 8pt; font-style: italic;'><TMPL_VAR expr="ml('/talkpost.bml.nosubjecthtml')"></span></div>

        <TMPL_IF text_hint>
            <div id="subjectCaptionText"><TMPL_VAR text_hint></div>
        </TMPL_IF>

        <div id='userpics'>
            <TMPL_IF show_userpics>
                <TMPL_VAR ml_picturetouse>
                <select name="prop_picture_keyword">
                    <TMPL_LOOP userpics>
                        <option value="<TMPL_VAR userpic_keyword>" <TMPL_IF userpic_selected>selected="selected"</TMPL_IF>><TMPL_VAR userpic_title></option>
                    </TMPL_LOOP>
                </select>
                <TMPL_VAR helpicon_userpics>
            </TMPL_IF>

            &nbsp;&nbsp;<label for='prop_opt_preformatted'><TMPL_VAR expr="ml('/talkpost.bml.opt.noautoformat')"></label>
            <input type="checkbox" name="prop_opt_preformatted" id="prop_opt_preformatted" value="1" <TMPL_IF opt_preformatted_selected>checked="checked"</TMPL_IF>>
            <TMPL_VAR helpicon_noautoformat>

            <TMPL_IF show_quick_quote>
                <script type='text/javascript' language='JavaScript'>
                <!--
                var helped = 0; var pasted = 0;
                function quote () {
                    var text = '';

                    if (document.getSelection) {
                        text = document.getSelection();
                    } else if (document.selection) {
                        text = document.selection.createRange().text;
                    } else if (window.getSelection) {
                        text = window.getSelection();
                    }

                    // Fix for Safari
                    if (typeof(text) == 'object') text = text.toString();
                    if (text == '') {
                        if (helped != 1 && pasted != 1) {
                            helped = 1; alert("If you'd like to quote a portion of the original message, highlight it then press 'Quote'");
                        }
                        return false;
                    } else {
                        pasted = 1;
                    }

                    var element = text.search(/\\n/) == -1 ? 'q' : 'blockquote';
                    var textarea = document.getElementById('commenttext');
                    textarea.focus();
                    textarea.value = textarea.value + "<" + element + ">" + text + "</" + element + ">";
                    textarea.caretPos = textarea.value;
                    textarea.focus();
                    return false;
                }
                if (document.getElementById && (document.getSelection || document.selection || window.getSelection)) {
                    // Opera clears the paste buffer before mouse events, useless here
                        if (navigator.userAgent.indexOf("Opera") == -1) {
                            document.write('&nbsp;&nbsp;<input type="button" value="Quote" onmousedown="quote();" onclick="quote();" />');
                        }
                }
                //-->
                </script>
            </TMPL_IF>
        </div>
    </td>
</tr>

<TMPL_IF 0> textarea for their message body </TMPL_IF>
<tr valign='top'>
    <td align='right'><TMPL_VAR expr="ml('/talkpost.bml.opt.message')"></td>
    <td style='width: 90%'>
        <textarea class='textbox' rows='10' cols='75' wrap='soft' name='body' id='commenttext'><TMPL_VAR comment_body></textarea>

        <TMPL_IF captcha_html>
            <TMPL_VAR captcha_html>
            <br />
        </TMPL_IF>

        <br />
        <script language="JavaScript" type='text/javascript'>
            <!--
            function checkLength() {
                if (!document.getElementById) return true;
                var textbox = document.getElementById('commenttext');
                if (!textbox) return true;
                if (textbox.value.length > <TMPL_VAR comment_length_cap>) {
                    alert('Sorry, but your comment of ' + textbox.value.length + ' characters exceeds the maximum character length of <TMPL_VAR comment_length_cap>.  Please try shortening it and then post again.');
                    return false;
                }
                return true;
            }
            // -->
        </script>

        <input type='submit' name='submitpost' onclick='return checkLength() && sendForm("postform", "username")'
            <TMPL_IF editid>
                value="<TMPL_VAR expr="ml('/talkpost.bml.opt.edit')">"
            <TMPL_ELSE>
                value="<TMPL_VAR expr="ml('/talkpost.bml.opt.submit')">"
            </TMPL_IF>
        />
        &nbsp;
        <input type='submit' name='submitpreview' onclick='return checkLength() && sendForm("postform", "username")'
            value="<TMPL_VAR expr="ml('talk.btn.preview')">" />

        <TMPL_IF show_spellcheck>
            <input type='checkbox' name='do_spellcheck' value='1' id='spellcheck' />
            <label for='spellcheck'><TMPL_VAR expr="ml('talk.spellcheck')"></label>
        </TMPL_IF>

        <TMPL_IF show_logips>
            <br/><TMPL_VAR ml_logcommentips>
            <TMPL_VAR helpicon_iplogging>
        </TMPL_IF>
    </td>
</tr>
</table>

<TMPL_IF 0> Some JavaScript to help the UI out </TMPL_IF>
<script type='text/javascript' language='JavaScript'>
    var usermismatchtext = "<TMPL_VAR ml_usermismatch>";
</script>
<script type='text/javascript' language='JavaScript' src='<TMPL_VAR lj_jsprefix>/talkpost.js'></script>

</form>
